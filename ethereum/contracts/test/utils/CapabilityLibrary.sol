// SPDX-License-Identifier: GPL-3.0-or-later
pragma solidity >=0.6.0 <0.9.0;

import "forge-std/Test.sol";

abstract contract CapabilityPermissionsLibFixtureTest is Test {
    address public capabilityLibraryLibAddress;
    address constant CAPABILITY_LIB_ADDRESS = 0x7FA9385bE102ac3EAc297483Dd6233D62b3e1496;
    bytes constant CAPABILITY_LIB_DEPLOYED_CODE = bytes(
        hex"73000000000000000000000000000000000000000030146080604052600436106100be5760003560e01c8063722c2bbc1161007b578063722c2bbc14610185578063a977a41a146101a5578063b20aa93e146101c5578063b976d74d146101e6578063db50e575146101f9578063fcfeddca1461020c57600080fd5b80631801c732146100c35780631e0c4aa3146100f0578063288f45c9146101125780633ff1b9141461013257806358fad824146101525780636584582514610165575b600080fd5b6100d66100d1366004611428565b61022c565b604080519283526020830191909152015b60405180910390f35b8180156100fc57600080fd5b5061011061010b3660046114bc565b610328565b005b81801561011e57600080fd5b5061011061012d3660046114fe565b6103a1565b81801561013e57600080fd5b5061011061014d36600461152e565b61048c565b6100d661016036600461158b565b61051b565b81801561017157600080fd5b506101106101803660046114fe565b6105b1565b81801561019157600080fd5b506101106101a03660046115c8565b610694565b8180156101b157600080fd5b506101106101c03660046114fe565b61071c565b6101d86101d3366004611620565b6107d3565b6040519081526020016100e7565b6100d66101f4366004611655565b610824565b61011061020736600461168a565b61088e565b81801561021857600080fd5b506101106102273660046114fe565b610969565b815160009081906007811115610255576040516317a4d98760e31b815260040160405180910390fd5b8351855114610277576040516374f4d53760e01b815260040160405180910390fd5b6000805b828110156102da5761028e81602061175c565b6102999060e061177b565b60e08883815181106102ad576102ad611792565b60200260200101516001600160e01b031916901c901b8217915080806102d2906117a8565b91505061027b565b5060005b8281101561031d57808682815181106102f9576102f9611792565b602002602001015160001b901b821791508080610315906117a8565b9150506102de565b509590945092505050565b6001600160a01b03821660009081526004840160205260409020805482919060ff19166001838181111561035e5761035e6117c1565b02179055507f2421030990d8336744cebf877f1b7a26f00c7d293e5dae6d36892afa52ce345282826040516103949291906117f5565b60405180910390a1505050565b6001600160a01b0381166103c85760405163867915ab60e01b815260040160405180910390fd5b604080518082019091528060018152602001600290526001600160a01b0382166000908152600180850160205260409091208251815491929091839160ff1990911690838181111561041c5761041c6117c1565b021790555060208201518154829061ff001916610100836003811115610444576104446117c1565b0217905550506040516001600160a01b03831681527fb4b0ef23cc28cee95092f509ac83986f0031f36e49490b1aebf8e251e6e8142b91506020015b60405180910390a15050565b600061049885856107d3565b6000818152600288016020908152604080832087845290915290208054919250839160ff1916600183818111156104d1576104d16117c1565b02179055507f44fd979464aad5cbff203ef28285a515f9a116425c209eef82b3204e00cb73748585858560405161050b949392919061181b565b60405180910390a1505050505050565b805160009081906007811115610544576040516317a4d98760e31b815260040160405180910390fd5b6000805b828110156105a75761055b81602061175c565b6105669060e061177b565b60e087838151811061057a5761057a611792565b60200260200101516001600160e01b031916901c901b82179150808061059f906117a8565b915050610548565b5094909350915050565b6001600160a01b0381166105d85760405163867915ab60e01b815260040160405180910390fd5b604080518082019091528060018152602001600190526001600160a01b0382166000908152600180850160205260409091208251815491929091839160ff1990911690838181111561062c5761062c6117c1565b021790555060208201518154829061ff001916610100836003811115610654576106546117c1565b0217905550506040516001600160a01b03831681527f194ba6b740bcb900415cde3029bf552c63971643ff18403e3e59f8c04d48578e9150602001610480565b60006106a085856107d3565b600081815260038801602090815260408083206001600160a01b038816845290915290208054919250839160ff1916600183818111156106e2576106e26117c1565b02179055507f7f92ae3755201b7b92cd5c2f16831f37ada0244da93aefc9878c5b9fdcec9cef8585858560405161050b949392919061185a565b604080518082018252600080825260208083018290526001600160a01b0385168252600186810190915292902081518154929391929091839160ff191690838181111561076b5761076b6117c1565b021790555060208201518154829061ff001916610100836003811115610793576107936117c1565b0217905550506040516001600160a01b03831681527f0dfce1ea4ba1eeba891ffb2a066790fbc293a9e517fe61d49d156a30165f93f39150602001610480565b6040516bffffffffffffffffffffffff19606084901b1660208201526001600160e01b03198216603482015260009060380160405160208183030381529060405261081d9061188b565b9392505050565b8051600090819061010081111561084e576040516317a4d98760e31b815260040160405180910390fd5b6000805b828110156105a7578086828151811061086d5761086d611792565b6020026020010151901b821791508080610886906117a8565b915050610852565b3360009081526020889052604090205460ff166108be57604051631fb1d3e560e31b815260040160405180910390fd5b846001600160a01b0316866001600160a01b03160361091c576109178784848080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250610a4c92505050565b610960565b61096087868686868080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250889250610aed915050565b50505050505050565b6001600160a01b0381166109905760405163867915ab60e01b815260040160405180910390fd5b604080518082019091528060018152602001600390526001600160a01b0382166000908152600180850160205260409091208251815491929091839160ff199091169083818111156109e4576109e46117c1565b021790555060208201518154829061ff001916610100836003811115610a0c57610a0c6117c1565b0217905550506040516001600160a01b03831681527f076088f2d63ed812caa7114d067a40bdb6700fbb448bc0f5981a216c130089349150602001610480565b600080600060606000806024870151905080602014610a7e57604051637ed1113760e01b815260040160405180910390fd5b60645b8751811015610ae2578088015160f81c96506001810188015160601c95506015810188015194506035810188015192506035810188019350610ac6898787878b610aed565b610ad18360556118b2565b610adb90826118b2565b9050610a81565b505050505050505050565b815115801590610afe575060048251105b15610b1c57604051632342609160e11b815260040160405180910390fd5b6001600160a01b03841660009081526001808701602052604090912090815460ff166001811115610b4f57610b4f6117c1565b14610b6d57604051633bcd102b60e21b815260040160405180910390fd5b8054610b849085908490610100900460ff16610c1b565b60018154610100900460ff166003811115610ba157610ba16117c1565b03610bb757610bb1868685610cc4565b50610c14565b60028154610100900460ff166003811115610bd457610bd46117c1565b03610be457610bb1868685610d92565b60038154610100900460ff166003811115610c0157610c016117c1565b03610c1257610bb186868551610e85565b505b5050505050565b6001826001811115610c2f57610c2f6117c1565b03610c4d576040516306c4a1c760e11b815260040160405180910390fd5b600083118015610c6f57506003816003811115610c6c57610c6c6117c1565b14155b15610c8d576040516309e9cd4960e01b815260040160405180910390fd5b6000816003811115610ca157610ca16117c1565b03610cbf5760405163a2855a1760e01b815260040160405180910390fd5b505050565b6000610ccf826118ca565b90506000610cdd84836107d3565b90506000610cec846000610ef3565b90506001600083815260038801602090815260408083206001600160a01b038616845290915290205460ff166001811115610d2957610d296117c1565b14610d47576040516318f4c12360e11b815260040160405180910390fd5b633213221d60e11b6001600160e01b0319841601610c12576000610d7286634341abdd60e01b6107d3565b9050600080610d82876002610f5e565b91509150610ae289848484611040565b6000610d9d826118ca565b90506000610dab84836107d3565b9050633a52dff360e01b6001600160e01b0319831601610e69576000610dd28460006110d1565b90506000610de18560016110d1565b90508051825114610e05576040516374f4d53760e01b815260040160405180910390fd5b60005b8251811015610e6157610e4f8885858481518110610e2857610e28611792565b6020026020010151858581518110610e4257610e42611792565b6020026020010151611040565b80610e59816117a8565b915050610e08565b505050610c14565b600080610e75856111d4565b9150915061096087848484611040565b60016001600160a01b038316600090815260048501602052604090205460ff166001811115610eb657610eb66117c1565b14610ed4576040516309e9cd4960e01b815260040160405180910390fd5b8015610cbf576040516318f4c12360e11b815260040160405180910390fd5b6000610f0082602061175c565b610f0b9060046118b2565b610f169060206118b2565b83511015610f3757604051631d098e2d60e21b815260040160405180910390fd5b6000610f4483602061175c565b610f4f9060046118b2565b93909301602001519392505050565b600080610f6c83602061175c565b610f779060046118b2565b610f829060206118b2565b84511015610fa357604051631d098e2d60e21b815260040160405180910390fd5b602484016000610fb485602061175c565b8281015180840151919250906000610fcd8360046118b2565b610fd89060206118b2565b90506000610fe683836118b2565b9050808a51101561100a57604051631d098e2d60e21b815260040160405180910390fd5b6000806110188c858561120b565b80602001905181019061102b9190611901565b50919e909d509b505050505050505050505050565b6040516bffffffffffffffffffffffff19606084811b8216602084015283901b16603482015260009060480160408051808303601f19018152918152815160209283012060008781526002890184528281208282529093529082205490925060ff1660018111156110b3576110b36117c1565b14610c14576040516318f4c12360e11b815260040160405180910390fd5b60606110de82602061175c565b6110e99060046118b2565b6110f49060206118b2565b8351101561111557604051631d098e2d60e21b815260040160405180910390fd5b60248301600061112684602061175c565b828101518084015191925090600061113f8360046118b2565b9050600061114e83602061175c565b61115890836118b2565b6111639060206118b2565b9050808951101561118757604051631d098e2d60e21b815260040160405180910390fd5b60206111948a848461120b565b6040516020016111a5929190611949565b6040516020818303038152906040528060200190518101906111c79190611990565b9998505050505050505050565b6000806044835110156111fa57604051631d098e2d60e21b815260040160405180910390fd5b505060248101516044909101519091565b6060611217838361177b565b67ffffffffffffffff81111561122f5761122f6112d3565b6040519080825280601f01601f191660200182016040528015611259576020820181803683370190505b509050825b828110156112cb5784818151811061127857611278611792565b01602001516001600160f81b03191682611292868461177b565b815181106112a2576112a2611792565b60200101906001600160f81b031916908160001a905350806112c3816117a8565b91505061125e565b509392505050565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff81118282101715611312576113126112d3565b604052919050565b600067ffffffffffffffff821115611334576113346112d3565b5060051b60200190565b80356001600160e01b03198116811461135657600080fd5b919050565b600082601f83011261136c57600080fd5b8135602061138161137c8361131a565b6112e9565b82815260059290921b840181019181810190868411156113a057600080fd5b8286015b848110156113c2576113b58161133e565b83529183019183016113a4565b509695505050505050565b600082601f8301126113de57600080fd5b813560206113ee61137c8361131a565b82815260059290921b8401810191818101908684111561140d57600080fd5b8286015b848110156113c25780358352918301918301611411565b6000806040838503121561143b57600080fd5b823567ffffffffffffffff8082111561145357600080fd5b61145f8683870161135b565b9350602085013591508082111561147557600080fd5b50611482858286016113cd565b9150509250929050565b6001600160a01b03811681146114a157600080fd5b50565b600281106114a157600080fd5b8035611356816114a4565b6000806000606084860312156114d157600080fd5b8335925060208401356114e38161148c565b915060408401356114f3816114a4565b809150509250925092565b6000806040838503121561151157600080fd5b8235915060208301356115238161148c565b809150509250929050565b600080600080600060a0868803121561154657600080fd5b8535945060208601356115588161148c565b93506115666040870161133e565b925060608601359150608086013561157d816114a4565b809150509295509295909350565b60006020828403121561159d57600080fd5b813567ffffffffffffffff8111156115b457600080fd5b6115c08482850161135b565b949350505050565b600080600080600060a086880312156115e057600080fd5b8535945060208601356115f28161148c565b93506116006040870161133e565b925060608601356116108161148c565b9150608086013561157d816114a4565b6000806040838503121561163357600080fd5b823561163e8161148c565b915061164c6020840161133e565b90509250929050565b60006020828403121561166757600080fd5b813567ffffffffffffffff81111561167e57600080fd5b6115c0848285016113cd565b600080600080600080600060c0888a0312156116a557600080fd5b8735965060208801356116b78161148c565b955060408801356116c78161148c565b945060608801359350608088013567ffffffffffffffff808211156116eb57600080fd5b818a0191508a601f8301126116ff57600080fd5b81358181111561170e57600080fd5b8b602082850101111561172057600080fd5b60208301955080945050505061173860a089016114b1565b905092959891949750929550565b634e487b7160e01b600052601160045260246000fd5b600081600019048311821515161561177657611776611746565b500290565b60008282101561178d5761178d611746565b500390565b634e487b7160e01b600052603260045260246000fd5b6000600182016117ba576117ba611746565b5060010190565b634e487b7160e01b600052602160045260246000fd5b600281106114a157634e487b7160e01b600052602160045260246000fd5b6001600160a01b03831681526040810161180e836117d7565b8260208301529392505050565b6001600160a01b03851681526001600160e01b031984166020820152604081018390526080810161184b836117d7565b82606083015295945050505050565b6001600160a01b0385811682526001600160e01b031985166020830152831660408201526080810161184b836117d7565b805160208083015191908110156118ac576000198160200360031b1b821691505b50919050565b600082198211156118c5576118c5611746565b500190565b805160208201516001600160e01b031980821692919060048310156118f95780818460040360031b1b83161693505b505050919050565b6000806000806080858703121561191757600080fd5b84516119228161148c565b60208601519094506119338161148c565b6040860151606090960151949790965092505050565b8281526000825160005b8181101561196f57602081860181015185830182015201611953565b81811115611981576000602083860101525b50919091016020019392505050565b600060208083850312156119a357600080fd5b825167ffffffffffffffff8111156119ba57600080fd5b8301601f810185136119cb57600080fd5b80516119d961137c8261131a565b81815260059190911b820183019083810190878311156119f857600080fd5b928401925b82841015611a1f578351611a108161148c565b825292840192908401906119fd565b97965050505050505056fea26469706673582212201aa3546fd927e34186915f26d6c4a51ae968f1da8fcc57fc7b43097d092b309764736f6c634300080d0033"
    );

    function setUp() public virtual {
        // deploy capability code
        capabilityLibraryLibAddress = deployCode("CapabilityPermissions.sol:HoprCapabilityPermissions"); // 0x5615deb798bb3e4dfa0139dfa1b3d433cc23b72f
        vm.etch(CAPABILITY_LIB_ADDRESS, CAPABILITY_LIB_DEPLOYED_CODE);
    }
}
