---
#################################################################################
# Pipeline triggered nightly to check benchmark results 
#################################################################################
name: Nightly Benchmarks

env:
  RUST_BACKTRACE: "1"

on:
  schedule:
    - cron: "2 0 * * *" # Every day at 02:00 UTC
  workflow_dispatch:
    inputs:
      branch:
        required: true
        type: string
      type:
        required: true
        type: string

concurrency:
  group: ${{ github.ref }}-bencher-nightly
  cancel-in-progress: true

jobs:
  bencher-nightly-master:
    name: Benchmarks
    uses: ./.github/workflows/bencher.yaml
    secrets: inherit
    with:
      branch: ${{ inputs.branch }}
      type: ${{ inputs.type }}
  bencher-nightly-release-singapore:
    name: Benchmarks
    uses: ./.github/workflows/bencher.yaml
    needs: bencher-nightly-master # Ensure that the master branch job is completed before running this one to avoid overloading the server
    secrets: inherit
    with:
      branch: release/singapore
      type: scheduled
