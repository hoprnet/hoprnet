version: "3.9"

# Start an internal-only bridge network to simulate NAT (NATwork)
networks:
  hopr-local-network-1:
    driver: bridge
  hopr-local-network-2:
    driver: bridge

# Starts HOPRD behind NAT
services:
  hoprd-nat-node-1:
    
    build: .

    command:
      - "/opt/hopr/scripts/vagrant/startup-node.sh"
      - "--admin"
      - "--adminHost"
      - "0.0.0.0"
      - "--healthCheck"
      - "--healthCheckHost"
      - "0.0.0.0"
      - "--init"
      - "--rest"
      - "--restHost"
      - "0.0.0.0"
      - "--environment"
      - "hardhat-localhost"
      - "--apiToken"
      - "MyT0ken123^"
      - "--password"
      - "switzerland"
      - "--testPreferLocalAddresses"
   
    volumes:
      - "/opt/hopr:/opt/hopr"
      - "/var/hopr/identities:/var/hopr/identities"

    networks:
      - "hopr-local-network-1"

    ports:
      - "3000:3010"
      - "3001:3011"
    environment:
      - "DEBUG=hopr*"

  hoprd-nat-node-2:

      build: .

      command:
        - "/opt/hopr/scripts/vagrant/startup-node.sh"
        - "--admin"
        - "--adminHost"
        - "0.0.0.0"
        - "--healthCheck"
        - "--healthCheckHost"
        - "0.0.0.0"
        - "--init"
        - "--rest"
        - "--restHost"
        - "0.0.0.0"
        - "--environment"
        - "hardhat-localhost"
        - "--apiToken"
        - "MyT0ken123^"
        - "--password"
        - "switzerland"
        - "--testPreferLocalAddresses"

      volumes:
        - "/opt/hopr:/opt/hopr"
        - "/var/hopr/identities:/var/hopr/identities"

      networks:
        - "hopr-local-network-2"

      ports:
        - "3000:3020"
        - "3001:3021"
      environment:
        - "DEBUG=hopr*"
