version: '3.9'

# Start an internal-only bridge network to simulate NAT (NATwork)
networks:
  hopr-local-network-1:
    driver: bridge
  hopr-local-network-2:
    driver: bridge

# Starts HOPRD behind NAT
services:
  hoprd-nat-node-1:
    build: docker-runner/

    command:
      - "sh"
      - "-c"
      - >-
         ./prepare-node.sh && node /opt/hopr/packages/hoprd/lib/index.js --admin --adminHost 0.0.0.0
         --healthCheck --healthCheckHost 0.0.0.0 --init --rest --restHost 0.0.0.0 --environment hardhat-localhost
         --apiToken MyT0ken123^ --password switzerland --testPreferLocalAddresses
         --identity /var/hopr/identities/local-nat-node1.id

    volumes:
      - '/opt/hopr:/opt/hopr'
      - '/var/hopr/identities:/var/hopr/identities'

    networks:
      - 'hopr-local-network-1'

    ports:
      - '3010:3000'
      - '3011:3001'
    environment:
      - 'DEBUG=hopr*'

  hoprd-nat-node-2:
    build: docker-runner/

    command:
      - "sh"
      - "-c"
      - >-
        ./prepare-node.sh && node /opt/hopr/packages/hoprd/lib/index.js --admin --adminHost 0.0.0.0
        --healthCheck --healthCheckHost 0.0.0.0 --init --rest --restHost 0.0.0.0 --environment hardhat-localhost
        --apiToken MyT0ken123^ --password switzerland --testPreferLocalAddresses
        --identity /var/hopr/identities/local-nat-node2.id

    volumes:
      - '/opt/hopr:/opt/hopr'
      - '/var/hopr/identities:/var/hopr/identities'

    networks:
      - 'hopr-local-network-2'

    ports:
      - '3020:3000'
      - '3021:3001'
    environment:
      - 'DEBUG=hopr*'
