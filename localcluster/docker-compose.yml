---
# FIXME: The nodes can't dial each other within the docker container. 

services:
  chain:
    container_name: hoprd-blokli-anvil
    platform: linux/amd64
    image: europe-west3-docker.pkg.dev/hoprassociation/docker-images/bloklid-anvil:latest@sha256:eca1c7ed30cf0aa39f7defb7609c0f33b5ec30ce91bb4d45aa171a7844ab5562
    ports:
      - "8080:8080"

  cluster:
    container_name: hoprd-localcluster
    platform: linux/amd64
    image: hoprd-localcluster:latest
    depends_on:
      - chain
    environment:
      HOPRD_CHAIN_URL: http://chain:8080
      RUST_LOG: debug
    command:
      - --size
      - "${CLUSTER_SIZE:-3}"
      - --api-port-base
      - "3001"
      - --p2p-port-base
      - "9001"
    ports:
      - "3001-300${CLUSTER_SIZE:-3}:3001-300${CLUSTER_SIZE:-3}"
