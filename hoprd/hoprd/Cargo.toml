[package]
name = "hoprd"
version = "2.2.0"
authors = ["HOPR Association <tech@hoprnet.org>"]
edition = "2021"
description = "HOPR node executable."
homepage = "https://hoprnet.org/"
repository = "https://github.com/hoprnet/hoprnet"
license = "GPL-3.0-only"
build = "build.rs"

[features]
default = [
  "runtime-tokio",
  "prometheus",
  "telemetry",
] # uses tokio by default because of axum
prometheus = [
  "dep:hopr-metrics",
  "dep:lazy_static",
  "hopr-lib/prometheus",
  "hoprd-api/prometheus",
  "hopr-network-types/prometheus",
]
runtime-async-std = [
  "dep:async-std",
  "hopr-lib/runtime-async-std",
  "hopr-network-types/runtime-async-std",
  "hopr-async-runtime/runtime-async-std",
  "opentelemetry_sdk?/rt-async-std",
]
runtime-tokio = [
  "dep:tokio",
  "dep:tokio-retry",
  "tokio-util/compat",
  "hopr-lib/runtime-tokio",
  "hopr-network-types/runtime-tokio",
  "hopr-async-runtime/runtime-tokio",
  "opentelemetry_sdk?/rt-tokio",
]
telemetry = [
  "dep:opentelemetry",
  "dep:opentelemetry-otlp",
  "dep:opentelemetry_sdk",
  "dep:tracing-opentelemetry",
]

[dependencies]
anyhow = { workspace = true }
async-broadcast = { workspace = true }
async-lock = { workspace = true }
async-signal = { workspace = true }
async-std = { workspace = true, features = [
  "attributes",
  "tokio1",
], optional = true }
chrono = { workspace = true }
clap = { workspace = true }
const_format = { workspace = true }
futures = { workspace = true }
home = "0.5.9"
lazy_static = { workspace = true, optional = true }
proc-macro-regex = { workspace = true }
serde = { workspace = true }
serde_yaml = { workspace = true }
serde_json = { workspace = true }
signal-hook = { workspace = true }
strum = { workspace = true }
thiserror = { workspace = true }
tokio = { workspace = true, optional = true }
tokio-retry = { workspace = true, optional = true }
tokio-util = { workspace = true, optional = true }
tracing = { workspace = true }
tracing-subscriber = { workspace = true }
validator = { workspace = true }

opentelemetry = { workspace = true, optional = true }
opentelemetry-otlp = { workspace = true, default-features = false, features = [
  "trace",
  "reqwest-client",
  "tls-roots",
  "http-proto",
  "grpc-tonic",
], optional = true }
opentelemetry_sdk = { workspace = true, optional = true }
tracing-opentelemetry = { workspace = true, optional = true }

hopr-lib = { workspace = true, features = [
  "runtime-tokio",
  "session-client",
  "session-server",
] }
hoprd-db-api = { workspace = true }
hoprd-api = { workspace = true }
hoprd-inbox = { workspace = true }
hoprd-keypair = { workspace = true }
hopr-platform = { workspace = true }
hopr-metrics = { workspace = true, optional = true }
hopr-network-types = { workspace = true }
hopr-async-runtime = { workspace = true }

[dev-dependencies]
tempfile = { workspace = true }

[build-dependencies]
vergen-gix = { workspace = true, features = ["build"] }
anyhow = { workspace = true }
